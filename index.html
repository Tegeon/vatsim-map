<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		html { height: 100% }
		body { height: 100%; margin: 0; padding: 0 }
		#map-canvas { height: 100% }
	</style>
	<script	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAEHQbCSMxhU3UJbFnsCOUxOqwTffy0gQs&sensor=false&libraries=weather"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript">
	function initialize() {
		var mapOptions = {
			center: new google.maps.LatLng(7.4673, -67.0235),
			zoom: 5,
			mapTypeId: google.maps.MapTypeId.ROADMAP,
			disableDefaultUI: true,
		};
		var map = new google.maps.Map(document.getElementById("map-canvas"),
			mapOptions);

		var weatherLayer = new google.maps.weather.WeatherLayer({
			temperatureUnits: google.maps.weather.TemperatureUnit.CELSIUS
		});
		weatherLayer.setMap(map);

		var cloudLayer = new google.maps.weather.CloudLayer();
		cloudLayer.setMap(map);

		var json = (function () {
			var json = null;
			$.ajax({
				'async': false,
				'global': false,
				'url': 'json.php',
				'dataType': "json",
				'success': function (data) {
					json = data;
				}
			});
			return json;
		})(); 

		console.log(json);

		// Create the markers ad infowindows.
		for (index in json) addMarker(json[index]);
			function addMarker(data) {
			// Create the marker
			var marker = new google.maps.Marker({
				position: new google.maps.LatLng(data.latitude, data.longitude),
				map: map,
				title: data.callsign,
				icon: 'red_dot.png'
			});

		}		
	}

	google.maps.event.addDomListener(window, 'load', initialize);
	</script>
</head>
<body>
	<div id="map-canvas" style="width: 650px; height: 450px"></div>
</body>
</html>
